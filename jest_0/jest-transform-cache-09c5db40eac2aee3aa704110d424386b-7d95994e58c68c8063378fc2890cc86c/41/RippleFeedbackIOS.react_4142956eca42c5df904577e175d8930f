25a827079dea34b0b340d04f7cf629a6
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactNative = require("react-native");

var _color = _interopRequireDefault(require("color"));

var _utils = require("../utils");

var _colors = require("../styles/colors");

var _constants = require("../styles/constants");

var propTypes = {
  testID: _propTypes.default.string,
  color: _propTypes.default.string,
  maxOpacity: _propTypes.default.number,
  disabled: _propTypes.default.bool,
  children: _propTypes.default.element,
  onPress: _propTypes.default.func,
  onLongPress: _propTypes.default.func,
  onPressIn: _propTypes.default.func,
  onPressOut: _propTypes.default.func,
  style: _propTypes.default.shape({
    container: _utils.ViewPropTypes.style
  })
};
var defaultProps = {
  testID: null,
  children: null,
  onPress: null,
  onLongPress: null,
  onPressIn: null,
  onPressOut: null,
  color: (0, _color.default)(_colors.black).alpha(0.87).toString(),
  disabled: false,
  maxOpacity: 0.16,
  style: {}
};

var styles = _reactNative.StyleSheet.create({
  container: (0, _objectSpread2.default)({}, _reactNative.StyleSheet.absoluteFillObject, {
    overflow: 'hidden'
  })
});

var MAX_DIAMETER = 200;

var isRippleVisible = function isRippleVisible(_ref) {
  var onPress = _ref.onPress,
      onLongPress = _ref.onLongPress,
      onPressIn = _ref.onPressIn,
      onPressOut = _ref.onPressOut;
  return onPress || onLongPress || onPressIn || onPressOut;
};

var RippleFeedbackIOS = function (_PureComponent) {
  (0, _inherits2.default)(RippleFeedbackIOS, _PureComponent);

  function RippleFeedbackIOS(props, context) {
    var _this;

    (0, _classCallCheck2.default)(this, RippleFeedbackIOS);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(RippleFeedbackIOS).call(this, props, context));

    _this.onLayoutChanged = function (event) {
      try {
        var _event$nativeEvent$la = event.nativeEvent.layout,
            width = _event$nativeEvent$la.width,
            height = _event$nativeEvent$la.height;
        var diameter = Math.ceil(Math.sqrt(width * width + height * height));

        _this.setState({
          diameter: Math.min(diameter, MAX_DIAMETER)
        });
      } catch (e) {
        _this.setState({
          diameter: MAX_DIAMETER
        });
      }
    };

    _this.onLongPress = function () {
      var onLongPress = _this.props.onLongPress;
      var _this$state = _this.state,
          maxOpacity = _this$state.maxOpacity,
          opacityBackgroundValue = _this$state.opacityBackgroundValue;
      _this.longPress = true;

      _reactNative.Animated.timing(opacityBackgroundValue, {
        toValue: maxOpacity / 2,
        duration: 700,
        useNativeDriver: true
      }).start();

      if (onLongPress) {
        onLongPress();
      }
    };

    _this.onPress = function () {
      var onPress = _this.props.onPress;
      var _this$state2 = _this.state,
          maxOpacity = _this$state2.maxOpacity,
          diameter = _this$state2.diameter,
          opacityBackgroundValue = _this$state2.opacityBackgroundValue,
          opacityRippleValue = _this$state2.opacityRippleValue,
          scaleValue = _this$state2.scaleValue;

      _reactNative.Animated.parallel([_reactNative.Animated.timing(opacityBackgroundValue, {
        toValue: maxOpacity / 2,
        duration: 125 + diameter,
        easing: _reactNative.Easing.in(_reactNative.Easing.quad),
        useNativeDriver: true
      }), _reactNative.Animated.timing(opacityRippleValue, {
        toValue: 0,
        duration: 125 + diameter,
        useNativeDriver: true
      }), _reactNative.Animated.timing(scaleValue, {
        toValue: 1,
        duration: 125 + diameter,
        easing: _reactNative.Easing.out(_reactNative.Easing.quad),
        useNativeDriver: true
      })]).start(function () {
        _reactNative.Animated.timing(opacityBackgroundValue, {
          toValue: 0,
          duration: 225,
          easing: _reactNative.Easing.out(_reactNative.Easing.quad),
          useNativeDriver: true
        }).start();

        _this.setDefaultAnimatedValues();
      });

      if (onPress) {
        onPress();
      }
    };

    _this.onPressIn = function (event) {
      var onPressIn = _this.props.onPressIn;

      _this.setState({
        pressX: event.nativeEvent.locationX,
        pressY: event.nativeEvent.locationY
      });

      if (onPressIn) {
        onPressIn();
      }
    };

    _this.onPressOut = function () {
      var diameter = _this.state.diameter;
      var onPressOut = _this.props.onPressOut;
      var _this$state3 = _this.state,
          opacityBackgroundValue = _this$state3.opacityBackgroundValue,
          opacityRippleValue = _this$state3.opacityRippleValue,
          scaleValue = _this$state3.scaleValue;

      if (_this.longPress) {
        _this.longPress = false;

        _reactNative.Animated.parallel([_reactNative.Animated.timing(opacityBackgroundValue, {
          toValue: 0,
          duration: 500 + diameter,
          useNativeDriver: true
        }), _reactNative.Animated.timing(opacityRippleValue, {
          toValue: 0,
          duration: 125 + diameter,
          useNativeDriver: true
        }), _reactNative.Animated.timing(scaleValue, {
          toValue: 1,
          duration: 125 + diameter,
          easing: _reactNative.Easing.out(_reactNative.Easing.quad),
          useNativeDriver: true
        })]).start(_this.setDefaultAnimatedValues);
      }

      if (onPressOut) {
        onPressOut();
      }
    };

    _this.setDefaultAnimatedValues = function () {
      var _this$state4 = _this.state,
          maxOpacity = _this$state4.maxOpacity,
          scaleValue = _this$state4.scaleValue,
          opacityRippleValue = _this$state4.opacityRippleValue;
      scaleValue.setValue(0);
      opacityRippleValue.setValue(maxOpacity);
    };

    _this.renderRippleView = function () {
      var _this$state5 = _this.state,
          scaleValue = _this$state5.scaleValue,
          opacityRippleValue = _this$state5.opacityRippleValue,
          diameter = _this$state5.diameter,
          pressX = _this$state5.pressX,
          pressY = _this$state5.pressY,
          rippleColor = _this$state5.rippleColor;
      return _react.default.createElement(_reactNative.Animated.View, {
        key: "ripple-view",
        pointerEvents: "none",
        style: [{
          position: 'absolute',
          top: (pressY || 0) - diameter / 2,
          left: (pressX || 0) - diameter / 2,
          width: diameter,
          height: diameter,
          borderRadius: diameter / 2,
          transform: [{
            scale: scaleValue
          }],
          opacity: opacityRippleValue,
          backgroundColor: rippleColor.toString(),
          zIndex: _constants.ELEVATION_ZINDEX
        }]
      });
    };

    _this.renderOpacityBackground = function () {
      var _this$state6 = _this.state,
          opacityBackgroundValue = _this$state6.opacityBackgroundValue,
          rippleColor = _this$state6.rippleColor;
      return _react.default.createElement(_reactNative.Animated.View, {
        key: "ripple-opacity",
        pointerEvents: "none",
        style: [(0, _objectSpread2.default)({}, _reactNative.StyleSheet.absoluteFillObject, {
          opacity: opacityBackgroundValue,
          backgroundColor: rippleColor.toString(),
          zIndex: _constants.ELEVATION_ZINDEX
        })]
      });
    };

    var _maxOpacity = (0, _color.default)(props.color).isDark() ? 0.12 : 0.3;

    _this.state = {
      scaleValue: new _reactNative.Animated.Value(0),
      opacityRippleValue: new _reactNative.Animated.Value(_maxOpacity),
      opacityBackgroundValue: new _reactNative.Animated.Value(0),
      diameter: MAX_DIAMETER,
      maxOpacity: _maxOpacity,
      rippleColor: (0, _color.default)(props.color)
    };
    return _this;
  }

  (0, _createClass2.default)(RippleFeedbackIOS, [{
    key: "render",
    value: function render() {
      var _this$props = this.props,
          children = _this$props.children,
          disabled = _this$props.disabled,
          style = _this$props.style,
          testID = _this$props.testID;

      if (!isRippleVisible(this.props)) {
        return children;
      }

      var parent = _react.default.Children.only(children);

      var ripple = _react.default.createElement(_reactNative.View, {
        key: "ripple-feedback-layer",
        style: [styles.container, style.container],
        pointerEvents: "none"
      }, this.renderOpacityBackground(), this.renderRippleView());

      return _react.default.createElement(_reactNative.TouchableWithoutFeedback, {
        testID: testID,
        disabled: disabled,
        onLayout: this.onLayoutChanged,
        onPressIn: this.onPressIn,
        onLongPress: this.onLongPress,
        onPressOut: this.onPressOut,
        onPress: this.onPress
      }, _react.default.cloneElement(parent, [], parent.props.children, ripple));
    }
  }]);
  return RippleFeedbackIOS;
}(_react.PureComponent);

RippleFeedbackIOS.propTypes = propTypes;
RippleFeedbackIOS.defaultProps = defaultProps;
var _default = RippleFeedbackIOS;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJpcHBsZUZlZWRiYWNrSU9TLnJlYWN0LmpzIl0sIm5hbWVzIjpbInByb3BUeXBlcyIsInRlc3RJRCIsIlByb3BUeXBlcyIsInN0cmluZyIsImNvbG9yIiwibWF4T3BhY2l0eSIsIm51bWJlciIsImRpc2FibGVkIiwiYm9vbCIsImNoaWxkcmVuIiwiZWxlbWVudCIsIm9uUHJlc3MiLCJmdW5jIiwib25Mb25nUHJlc3MiLCJvblByZXNzSW4iLCJvblByZXNzT3V0Iiwic3R5bGUiLCJzaGFwZSIsImNvbnRhaW5lciIsIlZpZXdQcm9wVHlwZXMiLCJkZWZhdWx0UHJvcHMiLCJibGFjayIsImFscGhhIiwidG9TdHJpbmciLCJzdHlsZXMiLCJTdHlsZVNoZWV0IiwiY3JlYXRlIiwiYWJzb2x1dGVGaWxsT2JqZWN0Iiwib3ZlcmZsb3ciLCJNQVhfRElBTUVURVIiLCJpc1JpcHBsZVZpc2libGUiLCJSaXBwbGVGZWVkYmFja0lPUyIsInByb3BzIiwiY29udGV4dCIsIm9uTGF5b3V0Q2hhbmdlZCIsImV2ZW50IiwibmF0aXZlRXZlbnQiLCJsYXlvdXQiLCJ3aWR0aCIsImhlaWdodCIsImRpYW1ldGVyIiwiTWF0aCIsImNlaWwiLCJzcXJ0Iiwic2V0U3RhdGUiLCJtaW4iLCJlIiwic3RhdGUiLCJvcGFjaXR5QmFja2dyb3VuZFZhbHVlIiwibG9uZ1ByZXNzIiwiQW5pbWF0ZWQiLCJ0aW1pbmciLCJ0b1ZhbHVlIiwiZHVyYXRpb24iLCJ1c2VOYXRpdmVEcml2ZXIiLCJzdGFydCIsIm9wYWNpdHlSaXBwbGVWYWx1ZSIsInNjYWxlVmFsdWUiLCJwYXJhbGxlbCIsImVhc2luZyIsIkVhc2luZyIsImluIiwicXVhZCIsIm91dCIsInNldERlZmF1bHRBbmltYXRlZFZhbHVlcyIsInByZXNzWCIsImxvY2F0aW9uWCIsInByZXNzWSIsImxvY2F0aW9uWSIsInNldFZhbHVlIiwicmVuZGVyUmlwcGxlVmlldyIsInJpcHBsZUNvbG9yIiwicG9zaXRpb24iLCJ0b3AiLCJsZWZ0IiwiYm9yZGVyUmFkaXVzIiwidHJhbnNmb3JtIiwic2NhbGUiLCJvcGFjaXR5IiwiYmFja2dyb3VuZENvbG9yIiwiekluZGV4IiwiRUxFVkFUSU9OX1pJTkRFWCIsInJlbmRlck9wYWNpdHlCYWNrZ3JvdW5kIiwiaXNEYXJrIiwiVmFsdWUiLCJwYXJlbnQiLCJSZWFjdCIsIkNoaWxkcmVuIiwib25seSIsInJpcHBsZSIsImNsb25lRWxlbWVudCIsIlB1cmVDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBOztBQUNBOztBQUNBOztBQVFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQU1BLFNBQVMsR0FBRztBQUNoQkMsRUFBQUEsTUFBTSxFQUFFQyxtQkFBVUMsTUFERjtBQUVoQkMsRUFBQUEsS0FBSyxFQUFFRixtQkFBVUMsTUFGRDtBQU1oQkUsRUFBQUEsVUFBVSxFQUFFSCxtQkFBVUksTUFOTjtBQVVoQkMsRUFBQUEsUUFBUSxFQUFFTCxtQkFBVU0sSUFWSjtBQWNoQkMsRUFBQUEsUUFBUSxFQUFFUCxtQkFBVVEsT0FkSjtBQWtCaEJDLEVBQUFBLE9BQU8sRUFBRVQsbUJBQVVVLElBbEJIO0FBbUJoQkMsRUFBQUEsV0FBVyxFQUFFWCxtQkFBVVUsSUFuQlA7QUFvQmhCRSxFQUFBQSxTQUFTLEVBQUVaLG1CQUFVVSxJQXBCTDtBQXFCaEJHLEVBQUFBLFVBQVUsRUFBRWIsbUJBQVVVLElBckJOO0FBc0JoQkksRUFBQUEsS0FBSyxFQUFFZCxtQkFBVWUsS0FBVixDQUFnQjtBQUNyQkMsSUFBQUEsU0FBUyxFQUFFQyxxQkFBY0g7QUFESixHQUFoQjtBQXRCUyxDQUFsQjtBQTBCQSxJQUFNSSxZQUFZLEdBQUc7QUFDbkJuQixFQUFBQSxNQUFNLEVBQUUsSUFEVztBQUVuQlEsRUFBQUEsUUFBUSxFQUFFLElBRlM7QUFHbkJFLEVBQUFBLE9BQU8sRUFBRSxJQUhVO0FBSW5CRSxFQUFBQSxXQUFXLEVBQUUsSUFKTTtBQUtuQkMsRUFBQUEsU0FBUyxFQUFFLElBTFE7QUFN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QUFRLEVBQUVNLFFBRlo7QUFHRSxRQUFBLFFBQVEsRUFBRSxLQUFLMkIsZUFIakI7QUFJRSxRQUFBLFNBQVMsRUFBRSxLQUFLcEIsU0FKbEI7QUFLRSxRQUFBLFdBQVcsRUFBRSxLQUFLRCxXQUxwQjtBQU1FLFFBQUEsVUFBVSxFQUFFLEtBQUtFLFVBTm5CO0FBT0UsUUFBQSxPQUFPLEVBQUUsS0FBS0o7QUFQaEIsU0FTRzJFLGVBQU1JLFlBQU4sQ0FBbUJMLE1BQW5CLEVBQTJCLEVBQTNCLEVBQStCQSxNQUFNLENBQUNyRCxLQUFQLENBQWF2QixRQUE1QyxFQUFzRGdGLE1BQXRELENBVEgsQ0FERjtBQWFEOzs7RUFwUTZCRSxvQjs7QUF1UWhDNUQsaUJBQWlCLENBQUMvQixTQUFsQixHQUE4QkEsU0FBOUI7QUFDQStCLGlCQUFpQixDQUFDWCxZQUFsQixHQUFpQ0EsWUFBakM7ZUFFZVcsaUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvbm8tdW5yZXNvbHZlZCwgaW1wb3J0L2V4dGVuc2lvbnMgKi9cbmltcG9ydCBSZWFjdCwgeyBQdXJlQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7XG4gIEFuaW1hdGVkLFxuICBFYXNpbmcsXG4gIFZpZXcsXG4gIFRvdWNoYWJsZVdpdGhvdXRGZWVkYmFjayxcbiAgU3R5bGVTaGVldCxcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbi8qIGVzbGludC1lbmFibGUgaW1wb3J0L25vLXVucmVzb2x2ZWQsIGltcG9ydC9leHRlbnNpb25zICovXG5pbXBvcnQgQ29sb3IgZnJvbSAnY29sb3InO1xuaW1wb3J0IHsgVmlld1Byb3BUeXBlcyB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IGJsYWNrIH0gZnJvbSAnLi4vc3R5bGVzL2NvbG9ycyc7XG5pbXBvcnQgeyBFTEVWQVRJT05fWklOREVYIH0gZnJvbSAnLi4vc3R5bGVzL2NvbnN0YW50cyc7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgdGVzdElEOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBjb2xvcjogUHJvcFR5cGVzLnN0cmluZyxcbiAgLyoqXG4gICAqIE1heCBvcGFjaXR5IG9mIHJpcHBsZSBlZmZlY3RcbiAgICovXG4gIG1heE9wYWNpdHk6IFByb3BUeXBlcy5udW1iZXIsXG4gIC8qKlxuICAgKiBJZiB0cnVlLCB0aGUgaW50ZXJhY3Rpb24gd2lsbCBiZSBmb3JiaWRkZW5cbiAgICovXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgLyoqXG4gICAqIEl0J2xsIGJlIHVzZWQgaW5zdGVhZCBvZiBpY29uIChzZWUgcHJvcHMgbmFtZSkgaWYgZXhpc3RzXG4gICAqL1xuICBjaGlsZHJlbjogUHJvcFR5cGVzLmVsZW1lbnQsXG4gIC8qKlxuICAgKiBDYWxsIHdoZW4gaWNvbiB3YXMgcHJlc3NlZFxuICAgKi9cbiAgb25QcmVzczogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uTG9uZ1ByZXNzOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25QcmVzc0luOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25QcmVzc091dDogUHJvcFR5cGVzLmZ1bmMsXG4gIHN0eWxlOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIGNvbnRhaW5lcjogVmlld1Byb3BUeXBlcy5zdHlsZSxcbiAgfSksXG59O1xuY29uc3QgZGVmYXVsdFByb3BzID0ge1xuICB0ZXN0SUQ6IG51bGwsXG4gIGNoaWxkcmVuOiBudWxsLFxuICBvblByZXNzOiBudWxsLFxuICBvbkxvbmdQcmVzczogbnVsbCxcbiAgb25QcmVzc0luOiBudWxsLFxuICBvblByZXNzT3V0OiBudWxsLFxuICBjb2xvcjogQ29sb3IoYmxhY2spXG4gICAgLmFscGhhKDAuODcpXG4gICAgLnRvU3RyaW5nKCksXG4gIGRpc2FibGVkOiBmYWxzZSxcbiAgbWF4T3BhY2l0eTogMC4xNixcbiAgc3R5bGU6IHt9LFxufTtcblxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBjb250YWluZXI6IHtcbiAgICAuLi5TdHlsZVNoZWV0LmFic29sdXRlRmlsbE9iamVjdCxcbiAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gIH0sXG59KTtcblxuLyoqXG4gKiBVc3VhbHkgd2UgdXNlIHdpZHRoIGFuZCBoZWlnaHQgdG8gY29tcHV0ZSB0aGlzLiBJbiBjYXNlLCB0aGUgd2lkdGggb2YgY29udGFpbmVyIGlzIHRvbyBiaWdcbiAqIHdlIHVzZSB0aGlzIGNvbnN0YW50IGFzIGEgd2lkdGggb2YgcmlwcGxlIGVmZmVjdC5cbiAqL1xuY29uc3QgTUFYX0RJQU1FVEVSID0gMjAwO1xuXG5jb25zdCBpc1JpcHBsZVZpc2libGUgPSAoeyBvblByZXNzLCBvbkxvbmdQcmVzcywgb25QcmVzc0luLCBvblByZXNzT3V0IH0pID0+XG4gIG9uUHJlc3MgfHwgb25Mb25nUHJlc3MgfHwgb25QcmVzc0luIHx8IG9uUHJlc3NPdXQ7XG5cbmNsYXNzIFJpcHBsZUZlZWRiYWNrSU9TIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XG4gICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgLy8gaHR0cHM6Ly9tYXRlcmlhbC5nb29nbGUuY29tL2NvbXBvbmVudHMvYnV0dG9ucy5odG1sI2J1dHRvbnMtdG9nZ2xlLWJ1dHRvbnNcbiAgICBjb25zdCBtYXhPcGFjaXR5ID0gQ29sb3IocHJvcHMuY29sb3IpLmlzRGFyaygpID8gMC4xMiA6IDAuMztcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBzY2FsZVZhbHVlOiBuZXcgQW5pbWF0ZWQuVmFsdWUoMCksXG4gICAgICBvcGFjaXR5UmlwcGxlVmFsdWU6IG5ldyBBbmltYXRlZC5WYWx1ZShtYXhPcGFjaXR5KSxcbiAgICAgIG9wYWNpdHlCYWNrZ3JvdW5kVmFsdWU6IG5ldyBBbmltYXRlZC5WYWx1ZSgwKSxcbiAgICAgIGRpYW1ldGVyOiBNQVhfRElBTUVURVIsXG4gICAgICBtYXhPcGFjaXR5LFxuICAgICAgcmlwcGxlQ29sb3I6IENvbG9yKHByb3BzLmNvbG9yKSxcbiAgICB9O1xuICB9XG5cbiAgb25MYXlvdXRDaGFuZ2VkID0gZXZlbnQgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBnZXQgd2lkdGggYW5kIGhlaWdodCBvZiB3cmFwcGVyXG4gICAgICBjb25zdCB7XG4gICAgICAgIG5hdGl2ZUV2ZW50OiB7XG4gICAgICAgICAgbGF5b3V0OiB7IHdpZHRoLCBoZWlnaHQgfSxcbiAgICAgICAgfSxcbiAgICAgIH0gPSBldmVudDtcbiAgICAgIGNvbnN0IGRpYW1ldGVyID0gTWF0aC5jZWlsKE1hdGguc3FydCh3aWR0aCAqIHdpZHRoICsgaGVpZ2h0ICogaGVpZ2h0KSk7XG5cbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBkaWFtZXRlcjogTWF0aC5taW4oZGlhbWV0ZXIsIE1BWF9ESUFNRVRFUiksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgZGlhbWV0ZXI6IE1BWF9ESUFNRVRFUixcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBvbkxvbmdQcmVzcyA9ICgpID0+IHtcbiAgICBjb25zdCB7IG9uTG9uZ1ByZXNzIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgY29uc3QgeyBtYXhPcGFjaXR5LCBvcGFjaXR5QmFja2dyb3VuZFZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIC8vIExvbmcgcHJlc3MgaGFzIHRvIGJlIGluZGljYXRlZCBsaWtlIHRoaXMgYmVjYXVzZSB3ZSBuZWVkIHRvIGFuaW1hdGUgY29udGFpbmVycyBiYWNrIHRvXG4gICAgLy8gZGVmYXVsdCB2YWx1ZXMgaW4gb25QcmVzc091dCBmdW5jdGlvblxuICAgIHRoaXMubG9uZ1ByZXNzID0gdHJ1ZTtcblxuICAgIC8vIEFuaW1hdGlvbiBvZiBsb25nIHByZXNzIGlzIHNsaWdodGx5IGRpZmZlcmVudCB0aGFuIG9uUHJlc3MgYW5pbWF0aW9uXG4gICAgQW5pbWF0ZWQudGltaW5nKG9wYWNpdHlCYWNrZ3JvdW5kVmFsdWUsIHtcbiAgICAgIHRvVmFsdWU6IG1heE9wYWNpdHkgLyAyLFxuICAgICAgZHVyYXRpb246IDcwMCxcbiAgICAgIHVzZU5hdGl2ZURyaXZlcjogdHJ1ZSxcbiAgICB9KS5zdGFydCgpO1xuXG4gICAgaWYgKG9uTG9uZ1ByZXNzKSB7XG4gICAgICBvbkxvbmdQcmVzcygpO1xuICAgIH1cbiAgfTtcblxuICBvblByZXNzID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgb25QcmVzcyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7XG4gICAgICBtYXhPcGFjaXR5LFxuICAgICAgZGlhbWV0ZXIsXG4gICAgICBvcGFjaXR5QmFja2dyb3VuZFZhbHVlLFxuICAgICAgb3BhY2l0eVJpcHBsZVZhbHVlLFxuICAgICAgc2NhbGVWYWx1ZSxcbiAgICB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIEFuaW1hdGVkLnBhcmFsbGVsKFtcbiAgICAgIC8vIERpc3BsYXkgYmFja2dyb3VuZCBsYXllciB0aHJ1IHdob2xlIG92ZXIgdGhlIHZpZXdcbiAgICAgIEFuaW1hdGVkLnRpbWluZyhvcGFjaXR5QmFja2dyb3VuZFZhbHVlLCB7XG4gICAgICAgIHRvVmFsdWU6IG1heE9wYWNpdHkgLyAyLFxuICAgICAgICBkdXJhdGlvbjogMTI1ICsgZGlhbWV0ZXIsXG4gICAgICAgIGVhc2luZzogRWFzaW5nLmluKEVhc2luZy5xdWFkKSxcbiAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiB0cnVlLFxuICAgICAgfSksXG4gICAgICAvLyBPcGFjaXR5IG9mIHJpcHBsZSBlZmZlY3Qgc3RhcnRzIG9uIG1heE9wYWNpdHkgYW5kIGdvZXMgdG8gMFxuICAgICAgQW5pbWF0ZWQudGltaW5nKG9wYWNpdHlSaXBwbGVWYWx1ZSwge1xuICAgICAgICB0b1ZhbHVlOiAwLFxuICAgICAgICBkdXJhdGlvbjogMTI1ICsgZGlhbWV0ZXIsXG4gICAgICAgIHVzZU5hdGl2ZURyaXZlcjogdHJ1ZSxcbiAgICAgIH0pLFxuICAgICAgLy8gU2NhbGUgb2YgcmlwcGxlIGVmZmVjdCBzdGFydHMgYXQgMCBhbmQgZ29lcyB0byAxXG4gICAgICBBbmltYXRlZC50aW1pbmcoc2NhbGVWYWx1ZSwge1xuICAgICAgICB0b1ZhbHVlOiAxLFxuICAgICAgICBkdXJhdGlvbjogMTI1ICsgZGlhbWV0ZXIsXG4gICAgICAgIGVhc2luZzogRWFzaW5nLm91dChFYXNpbmcucXVhZCksXG4gICAgICAgIHVzZU5hdGl2ZURyaXZlcjogdHJ1ZSxcbiAgICAgIH0pLFxuICAgIF0pLnN0YXJ0KCgpID0+IHtcbiAgICAgIC8vIEFmdGVyIHRoZSBlZmZlY3QgaXMgZnVsbHkgZGlzcGxheWVkIHdlIG5lZWQgYmFja2dyb3VuZCB0byBiZSBhbmltYXRlZCBiYWNrIHRvIGRlZmF1bHRcbiAgICAgIEFuaW1hdGVkLnRpbWluZyhvcGFjaXR5QmFja2dyb3VuZFZhbHVlLCB7XG4gICAgICAgIHRvVmFsdWU6IDAsXG4gICAgICAgIGR1cmF0aW9uOiAyMjUsXG4gICAgICAgIGVhc2luZzogRWFzaW5nLm91dChFYXNpbmcucXVhZCksXG4gICAgICAgIHVzZU5hdGl2ZURyaXZlcjogdHJ1ZSxcbiAgICAgIH0pLnN0YXJ0KCk7XG5cbiAgICAgIHRoaXMuc2V0RGVmYXVsdEFuaW1hdGVkVmFsdWVzKCk7XG4gICAgfSk7XG5cbiAgICBpZiAob25QcmVzcykge1xuICAgICAgb25QcmVzcygpO1xuICAgIH1cbiAgfTtcblxuICBvblByZXNzSW4gPSBldmVudCA9PiB7XG4gICAgY29uc3QgeyBvblByZXNzSW4gfSA9IHRoaXMucHJvcHM7XG5cbiAgICAvLyBiZWNhdXNlIHdlIG5lZWQgcmlwcGxlIGVmZmVjdCB0byBiZSBkaXNwbGF5ZWQgZXhhY3RseSBmcm9tIHByZXNzIHBvaW50XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBwcmVzc1g6IGV2ZW50Lm5hdGl2ZUV2ZW50LmxvY2F0aW9uWCxcbiAgICAgIHByZXNzWTogZXZlbnQubmF0aXZlRXZlbnQubG9jYXRpb25ZLFxuICAgIH0pO1xuXG4gICAgaWYgKG9uUHJlc3NJbikge1xuICAgICAgb25QcmVzc0luKCk7XG4gICAgfVxuICB9O1xuXG4gIG9uUHJlc3NPdXQgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBkaWFtZXRlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IG9uUHJlc3NPdXQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7XG4gICAgICBvcGFjaXR5QmFja2dyb3VuZFZhbHVlLFxuICAgICAgb3BhY2l0eVJpcHBsZVZhbHVlLFxuICAgICAgc2NhbGVWYWx1ZSxcbiAgICB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIC8vIFdoZW4gdXNlciB1c2Ugb25QcmVzcyBhbGwgYW5pbWF0aW9uIGhhcHBlbnMgaW4gb25QcmVzcyBtZXRob2QuIEJ1dCB3aGVuIHVzZXIgdXNlIGxvbmdcbiAgICAvLyBwcmVzcy4gV2UgZGlzcGxheWUgYmFja2dyb3VuZCBsYXllciBpbiBvbkxvbmdQcmVzcyBhbmQgdGhlbiB3ZSBuZWVkIHRvIGFuaW1hdGUgcmlwcGxlXG4gICAgLy8gZWZmZWN0IHRoYXQgaXMgZG9uZSBoZXJlLlxuICAgIGlmICh0aGlzLmxvbmdQcmVzcykge1xuICAgICAgdGhpcy5sb25nUHJlc3MgPSBmYWxzZTtcbiAgICAgIEFuaW1hdGVkLnBhcmFsbGVsKFtcbiAgICAgICAgLy8gSGlkZSBvcGFjaXR5IGJhY2tncm91bmQgbGF5ZXIsIHNsb3dseS4gSXQgaGFzIHRvIGJlIGRvbmUgbGF0ZXIgdGhhbiByaXBwbGVcbiAgICAgICAgLy8gZWZmZWN0XG4gICAgICAgIEFuaW1hdGVkLnRpbWluZyhvcGFjaXR5QmFja2dyb3VuZFZhbHVlLCB7XG4gICAgICAgICAgdG9WYWx1ZTogMCxcbiAgICAgICAgICBkdXJhdGlvbjogNTAwICsgZGlhbWV0ZXIsXG4gICAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiB0cnVlLFxuICAgICAgICB9KSxcbiAgICAgICAgLy8gT3BhY2l0eSBvZiByaXBwbGUgZWZmZWN0IHN0YXJ0cyBvbiBtYXhPcGFjaXR5IGFuZCBnb2VzIHRvIDBcbiAgICAgICAgQW5pbWF0ZWQudGltaW5nKG9wYWNpdHlSaXBwbGVWYWx1ZSwge1xuICAgICAgICAgIHRvVmFsdWU6IDAsXG4gICAgICAgICAgZHVyYXRpb246IDEyNSArIGRpYW1ldGVyLFxuICAgICAgICAgIHVzZU5hdGl2ZURyaXZlcjogdHJ1ZSxcbiAgICAgICAgfSksXG4gICAgICAgIC8vIFNjYWxlIG9mIHJpcHBsZSBlZmZlY3Qgc3RhcnRzIGF0IDAgYW5kIGdvZXMgdG8gMVxuICAgICAgICBBbmltYXRlZC50aW1pbmcoc2NhbGVWYWx1ZSwge1xuICAgICAgICAgIHRvVmFsdWU6IDEsXG4gICAgICAgICAgZHVyYXRpb246IDEyNSArIGRpYW1ldGVyLFxuICAgICAgICAgIGVhc2luZzogRWFzaW5nLm91dChFYXNpbmcucXVhZCksXG4gICAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiB0cnVlLFxuICAgICAgICB9KSxcbiAgICAgIF0pLnN0YXJ0KHRoaXMuc2V0RGVmYXVsdEFuaW1hdGVkVmFsdWVzKTtcbiAgICB9XG5cbiAgICBpZiAob25QcmVzc091dCkge1xuICAgICAgb25QcmVzc091dCgpO1xuICAgIH1cbiAgfTtcblxuICBzZXREZWZhdWx0QW5pbWF0ZWRWYWx1ZXMgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBtYXhPcGFjaXR5LCBzY2FsZVZhbHVlLCBvcGFjaXR5UmlwcGxlVmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgLy8gV2UgY2FuIHNldCB1cCBzY2FsZSB0byAwIGFuZCBvcGFjaXR5IGJhY2sgdG8gbWF4T3BhY2l0eVxuICAgIHNjYWxlVmFsdWUuc2V0VmFsdWUoMCk7XG4gICAgb3BhY2l0eVJpcHBsZVZhbHVlLnNldFZhbHVlKG1heE9wYWNpdHkpO1xuICB9O1xuXG4gIHJlbmRlclJpcHBsZVZpZXcgPSAoKSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgc2NhbGVWYWx1ZSxcbiAgICAgIG9wYWNpdHlSaXBwbGVWYWx1ZSxcbiAgICAgIGRpYW1ldGVyLFxuICAgICAgcHJlc3NYLFxuICAgICAgcHJlc3NZLFxuICAgICAgcmlwcGxlQ29sb3IsXG4gICAgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgLy8gd2UgbmVlZCBzZXQgemluZGV4IGZvciBpT1MsIGJlY2F1c2UgdGhlIGNvbXBvbmVudHMgd2l0aCBlbGV2YXRpb24gaGF2ZSB0aGVcbiAgICAgIC8vIHppbmRleCBzZXQgYXMgd2VsbCwgdGh1cywgdGhlcmUgY291bGQgYmUgZGlzcGxheWVkIGJhY2tncm91bmRDb2xvciBvZlxuICAgICAgLy8gY29tcG9uZW50IHdpdGggYmlnZ2VyIHppbmRleCAtIGFuZCB0aGF0J3Mgbm90IGdvb2RcbiAgICAgIDxBbmltYXRlZC5WaWV3XG4gICAgICAgIGtleT1cInJpcHBsZS12aWV3XCJcbiAgICAgICAgcG9pbnRlckV2ZW50cz1cIm5vbmVcIlxuICAgICAgICBzdHlsZT17W1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgdG9wOiAocHJlc3NZIHx8IDApIC0gZGlhbWV0ZXIgLyAyLFxuICAgICAgICAgICAgbGVmdDogKHByZXNzWCB8fCAwKSAtIGRpYW1ldGVyIC8gMixcbiAgICAgICAgICAgIHdpZHRoOiBkaWFtZXRlcixcbiAgICAgICAgICAgIGhlaWdodDogZGlhbWV0ZXIsXG4gICAgICAgICAgICBib3JkZXJSYWRpdXM6IGRpYW1ldGVyIC8gMixcbiAgICAgICAgICAgIHRyYW5zZm9ybTogW3sgc2NhbGU6IHNjYWxlVmFsdWUgfV0sXG4gICAgICAgICAgICBvcGFjaXR5OiBvcGFjaXR5UmlwcGxlVmFsdWUsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHJpcHBsZUNvbG9yLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB6SW5kZXg6IEVMRVZBVElPTl9aSU5ERVgsXG4gICAgICAgICAgfSxcbiAgICAgICAgXX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfTtcblxuICByZW5kZXJPcGFjaXR5QmFja2dyb3VuZCA9ICgpID0+IHtcbiAgICBjb25zdCB7IG9wYWNpdHlCYWNrZ3JvdW5kVmFsdWUsIHJpcHBsZUNvbG9yIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIC8vIHdlIG5lZWQgc2V0IHppbmRleCBmb3IgaU9TLCBiZWNhdXNlIHRoZSBjb21wb25lbnRzIHdpdGggZWxldmF0aW9uIGhhdmUgdGhlXG4gICAgICAvLyB6aW5kZXggc2V0IGFzIHdlbGwsIHRodXMsIHRoZXJlIGNvdWxkIGJlIGRpc3BsYXllZCBiYWNrZ3JvdW5kQ29sb3Igb2ZcbiAgICAgIC8vIGNvbXBvbmVudCB3aXRoIGJpZ2dlciB6aW5kZXggLSBhbmQgdGhhdCdzIG5vdCBnb29kXG4gICAgICA8QW5pbWF0ZWQuVmlld1xuICAgICAgICBrZXk9XCJyaXBwbGUtb3BhY2l0eVwiXG4gICAgICAgIHBvaW50ZXJFdmVudHM9XCJub25lXCJcbiAgICAgICAgc3R5bGU9e1tcbiAgICAgICAgICB7XG4gICAgICAgICAgICAuLi5TdHlsZVNoZWV0LmFic29sdXRlRmlsbE9iamVjdCxcbiAgICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlCYWNrZ3JvdW5kVmFsdWUsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHJpcHBsZUNvbG9yLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB6SW5kZXg6IEVMRVZBVElPTl9aSU5ERVgsXG4gICAgICAgICAgfSxcbiAgICAgICAgXX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBjaGlsZHJlbiwgZGlzYWJsZWQsIHN0eWxlLCB0ZXN0SUQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoIWlzUmlwcGxlVmlzaWJsZSh0aGlzLnByb3BzKSkge1xuICAgICAgcmV0dXJuIGNoaWxkcmVuO1xuICAgIH1cblxuICAgIGNvbnN0IHBhcmVudCA9IFJlYWN0LkNoaWxkcmVuLm9ubHkoY2hpbGRyZW4pO1xuXG4gICAgY29uc3QgcmlwcGxlID0gKFxuICAgICAgPFZpZXdcbiAgICAgICAga2V5PVwicmlwcGxlLWZlZWRiYWNrLWxheWVyXCJcbiAgICAgICAgc3R5bGU9e1tzdHlsZXMuY29udGFpbmVyLCBzdHlsZS5jb250YWluZXJdfVxuICAgICAgICBwb2ludGVyRXZlbnRzPVwibm9uZVwiXG4gICAgICA+XG4gICAgICAgIHt0aGlzLnJlbmRlck9wYWNpdHlCYWNrZ3JvdW5kKCl9XG4gICAgICAgIHt0aGlzLnJlbmRlclJpcHBsZVZpZXcoKX1cbiAgICAgIDwvVmlldz5cbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxUb3VjaGFibGVXaXRob3V0RmVlZGJhY2tcbiAgICAgICAgdGVzdElEPXt0ZXN0SUR9XG4gICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgICAgb25MYXlvdXQ9e3RoaXMub25MYXlvdXRDaGFuZ2VkfVxuICAgICAgICBvblByZXNzSW49e3RoaXMub25QcmVzc0lufVxuICAgICAgICBvbkxvbmdQcmVzcz17dGhpcy5vbkxvbmdQcmVzc31cbiAgICAgICAgb25QcmVzc091dD17dGhpcy5vblByZXNzT3V0fVxuICAgICAgICBvblByZXNzPXt0aGlzLm9uUHJlc3N9XG4gICAgICA+XG4gICAgICAgIHtSZWFjdC5jbG9uZUVsZW1lbnQocGFyZW50LCBbXSwgcGFyZW50LnByb3BzLmNoaWxkcmVuLCByaXBwbGUpfVxuICAgICAgPC9Ub3VjaGFibGVXaXRob3V0RmVlZGJhY2s+XG4gICAgKTtcbiAgfVxufVxuXG5SaXBwbGVGZWVkYmFja0lPUy5wcm9wVHlwZXMgPSBwcm9wVHlwZXM7XG5SaXBwbGVGZWVkYmFja0lPUy5kZWZhdWx0UHJvcHMgPSBkZWZhdWx0UHJvcHM7XG5cbmV4cG9ydCBkZWZhdWx0IFJpcHBsZUZlZWRiYWNrSU9TO1xuIl19