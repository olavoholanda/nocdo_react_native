988181a77337bcf9cbc11884d91c118e
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var EventEmitter = require("../vendor/emitter/EventEmitter");

var Platform = require("./Platform");

var RCTDeviceEventEmitter = require("../EventEmitter/RCTDeviceEventEmitter");

var invariant = require('fbjs/lib/invariant');

var eventEmitter = new EventEmitter();
var dimensionsInitialized = false;
var dimensions = {};

var Dimensions = function () {
  function Dimensions() {
    (0, _classCallCheck2.default)(this, Dimensions);
  }

  (0, _createClass2.default)(Dimensions, null, [{
    key: "set",
    value: function set(dims) {
      if (dims && dims.windowPhysicalPixels) {
        dims = JSON.parse(JSON.stringify(dims));
        var windowPhysicalPixels = dims.windowPhysicalPixels;
        dims.window = {
          width: windowPhysicalPixels.width / windowPhysicalPixels.scale,
          height: windowPhysicalPixels.height / windowPhysicalPixels.scale,
          scale: windowPhysicalPixels.scale,
          fontScale: windowPhysicalPixels.fontScale
        };

        if (Platform.OS === 'android') {
          var screenPhysicalPixels = dims.screenPhysicalPixels;
          dims.screen = {
            width: screenPhysicalPixels.width / screenPhysicalPixels.scale,
            height: screenPhysicalPixels.height / screenPhysicalPixels.scale,
            scale: screenPhysicalPixels.scale,
            fontScale: screenPhysicalPixels.fontScale
          };
          delete dims.screenPhysicalPixels;
        } else {
          dims.screen = dims.window;
        }

        delete dims.windowPhysicalPixels;
      }

      (0, _extends2.default)(dimensions, dims);

      if (dimensionsInitialized) {
        eventEmitter.emit('change', {
          window: dimensions.window,
          screen: dimensions.screen
        });
      } else {
        dimensionsInitialized = true;
      }
    }
  }, {
    key: "get",
    value: function get(dim) {
      invariant(dimensions[dim], 'No dimension set for key ' + dim);
      return dimensions[dim];
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(type, handler) {
      invariant(type === 'change', 'Trying to subscribe to unknown event: "%s"', type);
      eventEmitter.addListener(type, handler);
    }
  }, {
    key: "removeEventListener",
    value: function removeEventListener(type, handler) {
      invariant(type === 'change', 'Trying to remove listener for unknown event: "%s"', type);
      eventEmitter.removeListener(type, handler);
    }
  }]);
  return Dimensions;
}();

var dims = global.nativeExtensions && global.nativeExtensions.DeviceInfo && global.nativeExtensions.DeviceInfo.Dimensions;
var nativeExtensionsEnabled = true;

if (!dims) {
  var DeviceInfo = require("./DeviceInfo");

  dims = DeviceInfo.Dimensions;
  nativeExtensionsEnabled = false;
}

invariant(dims, 'Either DeviceInfo native extension or DeviceInfo Native Module must be registered');
Dimensions.set(dims);

if (!nativeExtensionsEnabled) {
  RCTDeviceEventEmitter.addListener('didUpdateDimensions', function (update) {
    Dimensions.set(update);
  });
}

module.exports = Dimensions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRpbWVuc2lvbnMuanMiXSwibmFtZXMiOlsiRXZlbnRFbWl0dGVyIiwicmVxdWlyZSIsIlBsYXRmb3JtIiwiUkNURGV2aWNlRXZlbnRFbWl0dGVyIiwiaW52YXJpYW50IiwiZXZlbnRFbWl0dGVyIiwiZGltZW5zaW9uc0luaXRpYWxpemVkIiwiZGltZW5zaW9ucyIsIkRpbWVuc2lvbnMiLCJkaW1zIiwid2luZG93UGh5c2ljYWxQaXhlbHMiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ3aW5kb3ciLCJ3aWR0aCIsInNjYWxlIiwiaGVpZ2h0IiwiZm9udFNjYWxlIiwiT1MiLCJzY3JlZW5QaHlzaWNhbFBpeGVscyIsInNjcmVlbiIsImVtaXQiLCJkaW0iLCJ0eXBlIiwiaGFuZGxlciIsImFkZExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJnbG9iYWwiLCJuYXRpdmVFeHRlbnNpb25zIiwiRGV2aWNlSW5mbyIsIm5hdGl2ZUV4dGVuc2lvbnNFbmFibGVkIiwic2V0IiwidXBkYXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxZQUFZLEdBQUdDLE9BQU8sa0NBQTVCOztBQUNBLElBQU1DLFFBQVEsR0FBR0QsT0FBTyxjQUF4Qjs7QUFDQSxJQUFNRSxxQkFBcUIsR0FBR0YsT0FBTyx5Q0FBckM7O0FBRUEsSUFBTUcsU0FBUyxHQUFHSCxPQUFPLENBQUMsb0JBQUQsQ0FBekI7O0FBRUEsSUFBTUksWUFBWSxHQUFHLElBQUlMLFlBQUosRUFBckI7QUFDQSxJQUFJTSxxQkFBcUIsR0FBRyxLQUE1QjtBQUNBLElBQU1DLFVBQVUsR0FBRyxFQUFuQjs7SUFDTUMsVTs7Ozs7Ozt3QkFPT0MsSSxFQUFrQztBQUkzQyxVQUFJQSxJQUFJLElBQUlBLElBQUksQ0FBQ0Msb0JBQWpCLEVBQXVDO0FBRXJDRCxRQUFBQSxJQUFJLEdBQUdFLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLFNBQUws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M0IsU0FBUyxDQUNQSyxJQURPLEVBRVAsbUZBRk8sQ0FBVDtBQUlBRCxVQUFVLENBQUN3QixHQUFYLENBQWV2QixJQUFmOztBQUNBLElBQUksQ0FBQ3NCLHVCQUFMLEVBQThCO0FBQzVCNUIsRUFBQUEscUJBQXFCLENBQUN1QixXQUF0QixDQUFrQyxxQkFBbEMsRUFBeUQsVUFBU08sTUFBVCxFQUFpQjtBQUN4RXpCLElBQUFBLFVBQVUsQ0FBQ3dCLEdBQVgsQ0FBZUMsTUFBZjtBQUNELEdBRkQ7QUFHRDs7QUFFREMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCM0IsVUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmb3JtYXRcbiAqIEBmbG93XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCcuLi92ZW5kb3IvZW1pdHRlci9FdmVudEVtaXR0ZXInKTtcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi9QbGF0Zm9ybScpO1xuY29uc3QgUkNURGV2aWNlRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnLi4vRXZlbnRFbWl0dGVyL1JDVERldmljZUV2ZW50RW1pdHRlcicpO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdmYmpzL2xpYi9pbnZhcmlhbnQnKTtcblxuY29uc3QgZXZlbnRFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xubGV0IGRpbWVuc2lvbnNJbml0aWFsaXplZCA9IGZhbHNlO1xuY29uc3QgZGltZW5zaW9ucyA9IHt9O1xuY2xhc3MgRGltZW5zaW9ucyB7XG4gIC8qKlxuICAgKiBUaGlzIHNob3VsZCBvbmx5IGJlIGNhbGxlZCBmcm9tIG5hdGl2ZSBjb2RlIGJ5IHNlbmRpbmcgdGhlXG4gICAqIGRpZFVwZGF0ZURpbWVuc2lvbnMgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBkaW1zIFNpbXBsZSBzdHJpbmcta2V5ZWQgb2JqZWN0IG9mIGRpbWVuc2lvbnMgdG8gc2V0XG4gICAqL1xuICBzdGF0aWMgc2V0KGRpbXM6IHtba2V5OiBzdHJpbmddOiBhbnl9KTogdm9pZCB7XG4gICAgLy8gV2UgY2FsY3VsYXRlIHRoZSB3aW5kb3cgZGltZW5zaW9ucyBpbiBKUyBzbyB0aGF0IHdlIGRvbid0IGVuY291bnRlciBsb3NzIG9mXG4gICAgLy8gcHJlY2lzaW9uIGluIHRyYW5zZmVycmluZyB0aGUgZGltZW5zaW9ucyAod2hpY2ggY291bGQgYmUgbm9uLWludGVnZXJzKSBvdmVyXG4gICAgLy8gdGhlIGJyaWRnZS5cbiAgICBpZiAoZGltcyAmJiBkaW1zLndpbmRvd1BoeXNpY2FsUGl4ZWxzKSB7XG4gICAgICAvLyBwYXJzZS9zdHJpbmdpZnkgPT4gQ2xvbmUgaGFja1xuICAgICAgZGltcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGltcykpO1xuXG4gICAgICBjb25zdCB3aW5kb3dQaHlzaWNhbFBpeGVscyA9IGRpbXMud2luZG93UGh5c2ljYWxQaXhlbHM7XG4gICAgICBkaW1zLndpbmRvdyA9IHtcbiAgICAgICAgd2lkdGg6IHdpbmRvd1BoeXNpY2FsUGl4ZWxzLndpZHRoIC8gd2luZG93UGh5c2ljYWxQaXhlbHMuc2NhbGUsXG4gICAgICAgIGhlaWdodDogd2luZG93UGh5c2ljYWxQaXhlbHMuaGVpZ2h0IC8gd2luZG93UGh5c2ljYWxQaXhlbHMuc2NhbGUsXG4gICAgICAgIHNjYWxlOiB3aW5kb3dQaHlzaWNhbFBpeGVscy5zY2FsZSxcbiAgICAgICAgZm9udFNjYWxlOiB3aW5kb3dQaHlzaWNhbFBpeGVscy5mb250U2NhbGUsXG4gICAgICB9O1xuICAgICAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgICAgLy8gU2NyZWVuIGFuZCB3aW5kb3cgZGltZW5zaW9ucyBhcmUgZGlmZmVyZW50IG9uIGFuZHJvaWRcbiAgICAgICAgY29uc3Qgc2NyZWVuUGh5c2ljYWxQaXhlbHMgPSBkaW1zLnNjcmVlblBoeXNpY2FsUGl4ZWxzO1xuICAgICAgICBkaW1zLnNjcmVlbiA9IHtcbiAgICAgICAgICB3aWR0aDogc2NyZWVuUGh5c2ljYWxQaXhlbHMud2lkdGggLyBzY3JlZW5QaHlzaWNhbFBpeGVscy5zY2FsZSxcbiAgICAgICAgICBoZWlnaHQ6IHNjcmVlblBoeXNpY2FsUGl4ZWxzLmhlaWdodCAvIHNjcmVlblBoeXNpY2FsUGl4ZWxzLnNjYWxlLFxuICAgICAgICAgIHNjYWxlOiBzY3JlZW5QaHlzaWNhbFBpeGVscy5zY2FsZSxcbiAgICAgICAgICBmb250U2NhbGU6IHNjcmVlblBoeXNpY2FsUGl4ZWxzLmZvbnRTY2FsZSxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBkZWxldGUgc28gbm8gY2FsbGVycyByZWx5IG9uIHRoaXMgZXhpc3RpbmdcbiAgICAgICAgZGVsZXRlIGRpbXMuc2NyZWVuUGh5c2ljYWxQaXhlbHM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaW1zLnNjcmVlbiA9IGRpbXMud2luZG93O1xuICAgICAgfVxuICAgICAgLy8gZGVsZXRlIHNvIG5vIGNhbGxlcnMgcmVseSBvbiB0aGlzIGV4aXN0aW5nXG4gICAgICBkZWxldGUgZGltcy53aW5kb3dQaHlzaWNhbFBpeGVscztcbiAgICB9XG5cbiAgICBPYmplY3QuYXNzaWduKGRpbWVuc2lvbnMsIGRpbXMpO1xuICAgIGlmIChkaW1lbnNpb25zSW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIERvbid0IGZpcmUgJ2NoYW5nZScgdGhlIGZpcnN0IHRpbWUgdGhlIGRpbWVuc2lvbnMgYXJlIHNldC5cbiAgICAgIGV2ZW50RW1pdHRlci5lbWl0KCdjaGFuZ2UnLCB7XG4gICAgICAgIHdpbmRvdzogZGltZW5zaW9ucy53aW5kb3csXG4gICAgICAgIHNjcmVlbjogZGltZW5zaW9ucy5zY3JlZW4sXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGltZW5zaW9uc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbCBkaW1lbnNpb25zIGFyZSBzZXQgYmVmb3JlIGBydW5BcHBsaWNhdGlvbmAgaXMgY2FsbGVkIHNvIHRoZXkgc2hvdWxkXG4gICAqIGJlIGF2YWlsYWJsZSBiZWZvcmUgYW55IG90aGVyIHJlcXVpcmUncyBhcmUgcnVuLCBidXQgbWF5IGJlIHVwZGF0ZWQgbGF0ZXIuXG4gICAqXG4gICAqIE5vdGU6IEFsdGhvdWdoIGRpbWVuc2lvbnMgYXJlIGF2YWlsYWJsZSBpbW1lZGlhdGVseSwgdGhleSBtYXkgY2hhbmdlIChlLmdcbiAgICogZHVlIHRvIGRldmljZSByb3RhdGlvbikgc28gYW55IHJlbmRlcmluZyBsb2dpYyBvciBzdHlsZXMgdGhhdCBkZXBlbmQgb25cbiAgICogdGhlc2UgY29uc3RhbnRzIHNob3VsZCB0cnkgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uIG9uIGV2ZXJ5IHJlbmRlciwgcmF0aGVyXG4gICAqIHRoYW4gY2FjaGluZyB0aGUgdmFsdWUgKGZvciBleGFtcGxlLCB1c2luZyBpbmxpbmUgc3R5bGVzIHJhdGhlciB0aGFuXG4gICAqIHNldHRpbmcgYSB2YWx1ZSBpbiBhIGBTdHlsZVNoZWV0YCkuXG4gICAqXG4gICAqIEV4YW1wbGU6IGB2YXIge2hlaWdodCwgd2lkdGh9ID0gRGltZW5zaW9ucy5nZXQoJ3dpbmRvdycpO2BcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRpbSBOYW1lIG9mIGRpbWVuc2lvbiBhcyBkZWZpbmVkIHdoZW4gY2FsbGluZyBgc2V0YC5cbiAgICogQHJldHVybnMge09iamVjdD99IFZhbHVlIGZvciB0aGUgZGltZW5zaW9uLlxuICAgKi9cbiAgc3RhdGljIGdldChkaW06IHN0cmluZyk6IE9iamVjdCB7XG4gICAgaW52YXJpYW50KGRpbWVuc2lvbnNbZGltXSwgJ05vIGRpbWVuc2lvbiBzZXQgZm9yIGtleSAnICsgZGltKTtcbiAgICByZXR1cm4gZGltZW5zaW9uc1tkaW1dO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBldmVudCBoYW5kbGVyLiBTdXBwb3J0ZWQgZXZlbnRzOlxuICAgKlxuICAgKiAtIGBjaGFuZ2VgOiBGaXJlcyB3aGVuIGEgcHJvcGVydHkgd2l0aGluIHRoZSBgRGltZW5zaW9uc2Agb2JqZWN0IGNoYW5nZXMuIFRoZSBhcmd1bWVudFxuICAgKiAgIHRvIHRoZSBldmVudCBoYW5kbGVyIGlzIGFuIG9iamVjdCB3aXRoIGB3aW5kb3dgIGFuZCBgc2NyZWVuYCBwcm9wZXJ0aWVzIHdob3NlIHZhbHVlc1xuICAgKiAgIGFyZSB0aGUgc2FtZSBhcyB0aGUgcmV0dXJuIHZhbHVlcyBvZiBgRGltZW5zaW9ucy5nZXQoJ3dpbmRvdycpYCBhbmRcbiAgICogICBgRGltZW5zaW9ucy5nZXQoJ3NjcmVlbicpYCwgcmVzcGVjdGl2ZWx5LlxuICAgKi9cbiAgc3RhdGljIGFkZEV2ZW50TGlzdGVuZXIodHlwZTogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge1xuICAgIGludmFyaWFudChcbiAgICAgIHR5cGUgPT09ICdjaGFuZ2UnLFxuICAgICAgJ1RyeWluZyB0byBzdWJzY3JpYmUgdG8gdW5rbm93biBldmVudDogXCIlc1wiJyxcbiAgICAgIHR5cGUsXG4gICAgKTtcbiAgICBldmVudEVtaXR0ZXIuYWRkTGlzdGVuZXIodHlwZSwgaGFuZGxlcik7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFuIGV2ZW50IGhhbmRsZXIuXG4gICAqL1xuICBzdGF0aWMgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlOiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgdHlwZSA9PT0gJ2NoYW5nZScsXG4gICAgICAnVHJ5aW5nIHRvIHJlbW92ZSBsaXN0ZW5lciBmb3IgdW5rbm93biBldmVudDogXCIlc1wiJyxcbiAgICAgIHR5cGUsXG4gICAgKTtcbiAgICBldmVudEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIodHlwZSwgaGFuZGxlcik7XG4gIH1cbn1cblxubGV0IGRpbXM6ID97W2tleTogc3RyaW5nXTogYW55fSA9XG4gIGdsb2JhbC5uYXRpdmVFeHRlbnNpb25zICYmXG4gIGdsb2JhbC5uYXRpdmVFeHRlbnNpb25zLkRldmljZUluZm8gJiZcbiAgZ2xvYmFsLm5hdGl2ZUV4dGVuc2lvbnMuRGV2aWNlSW5mby5EaW1lbnNpb25zO1xubGV0IG5hdGl2ZUV4dGVuc2lvbnNFbmFibGVkID0gdHJ1ZTtcbmlmICghZGltcykge1xuICBjb25zdCBEZXZpY2VJbmZvID0gcmVxdWlyZSgnLi9EZXZpY2VJbmZvJyk7XG4gIGRpbXMgPSBEZXZpY2VJbmZvLkRpbWVuc2lvbnM7XG4gIG5hdGl2ZUV4dGVuc2lvbnNFbmFibGVkID0gZmFsc2U7XG59XG5cbmludmFyaWFudChcbiAgZGltcyxcbiAgJ0VpdGhlciBEZXZpY2VJbmZvIG5hdGl2ZSBleHRlbnNpb24gb3IgRGV2aWNlSW5mbyBOYXRpdmUgTW9kdWxlIG11c3QgYmUgcmVnaXN0ZXJlZCcsXG4pO1xuRGltZW5zaW9ucy5zZXQoZGltcyk7XG5pZiAoIW5hdGl2ZUV4dGVuc2lvbnNFbmFibGVkKSB7XG4gIFJDVERldmljZUV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcignZGlkVXBkYXRlRGltZW5zaW9ucycsIGZ1bmN0aW9uKHVwZGF0ZSkge1xuICAgIERpbWVuc2lvbnMuc2V0KHVwZGF0ZSk7XG4gIH0pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IERpbWVuc2lvbnM7XG4iXX0=