2e22697cf578fd692cb5caa570789128
'use strict';

var Promise = require("./core.js");

module.exports = Promise;
var TRUE = valuePromise(true);
var FALSE = valuePromise(false);
var NULL = valuePromise(null);
var UNDEFINED = valuePromise(undefined);
var ZERO = valuePromise(0);
var EMPTYSTRING = valuePromise('');

function valuePromise(value) {
  var p = new Promise(Promise._61);
  p._65 = 1;
  p._55 = value;
  return p;
}

Promise.resolve = function (value) {
  if (value instanceof Promise) return value;
  if (value === null) return NULL;
  if (value === undefined) return UNDEFINED;
  if (value === true) return TRUE;
  if (value === false) return FALSE;
  if (value === 0) return ZERO;
  if (value === '') return EMPTYSTRING;

  if (typeof value === 'object' || typeof value === 'function') {
    try {
      var then = value.then;

      if (typeof then === 'function') {
        return new Promise(then.bind(value));
      }
    } catch (ex) {
      return new Promise(function (resolve, reject) {
        reject(ex);
      });
    }
  }

  return valuePromise(value);
};

Promise.all = function (arr) {
  var args = Array.prototype.slice.call(arr);
  return new Promise(function (resolve, reject) {
    if (args.length === 0) return resolve([]);
    var remaining = args.length;

    function res(i, val) {
      if (val && (typeof val === 'object' || typeof val === 'function')) {
        if (val instanceof Promise && val.then === Promise.prototype.then) {
          while (val._65 === 3) {
            val = val._55;
          }

          if (val._65 === 1) return res(i, val._55);
          if (val._65 === 2) reject(val._55);
          val.then(function (val) {
            res(i, val);
          }, reject);
          return;
        } else {
          var then = val.then;

          if (typeof then === 'function') {
            var p = new Promise(then.bind(val));
            p.then(function (val) {
              res(i, val);
            }, reject);
            return;
          }
        }
      }

      args[i] = val;

      if (--remaining === 0) {
        resolve(args);
      }
    }

    for (var i = 0; i < args.length; i++) {
      res(i, args[i]);
    }
  });
};

Promise.reject = function (value) {
  return new Promise(function (resolve, reject) {
    reject(value);
  });
};

Promise.race = function (values) {
  return new Promise(function (resolve, reject) {
    values.forEach(function (value) {
      Promise.resolve(value).then(resolve, reject);
    });
  });
};

Promise.prototype['catch'] = function (onRejected) {
  return this.then(null, onRejected);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzNi1leHRlbnNpb25zLmpzIl0sIm5hbWVzIjpbIlByb21pc2UiLCJyZXF1aXJlIiwibW9kdWxlIiwiZXhwb3J0cyIsIlRSVUUiLCJ2YWx1ZVByb21pc2UiLCJGQUxTRSIsIk5VTEwiLCJVTkRFRklORUQiLCJ1bmRlZmluZWQiLCJaRVJPIiwiRU1QVFlTVFJJTkciLCJ2YWx1ZSIsInAiLCJfNjEiLCJfNjUiLCJfNTUiLCJyZXNvbHZlIiwidGhlbiIsImJpbmQiLCJleCIsInJlamVjdCIsImFsbCIsImFyciIsImFyZ3MiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImxlbmd0aCIsInJlbWFpbmluZyIsInJlcyIsImkiLCJ2YWwiLCJyYWNlIiwidmFsdWVzIiwiZm9yRWFjaCIsIm9uUmVqZWN0ZWQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUlBLElBQUlBLE9BQU8sR0FBR0MsT0FBTyxhQUFyQjs7QUFFQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCSCxPQUFqQjtBQUlBLElBQUlJLElBQUksR0FBR0MsWUFBWSxDQUFDLElBQUQsQ0FBdkI7QUFDQSxJQUFJQyxLQUFLLEdBQUdELFlBQVksQ0FBQyxLQUFELENBQXhCO0FBQ0EsSUFBSUUsSUFBSSxHQUFHRixZQUFZLENBQUMsSUFBRCxDQUF2QjtBQUNBLElBQUlHLFNBQVMsR0FBR0gsWUFBWSxDQUFDSSxTQUFELENBQTVCO0FBQ0EsSUFBSUMsSUFBSSxHQUFHTCxZQUFZLENBQUMsQ0FBRCxDQUF2QjtBQUNBLElBQUlNLFdBQVcsR0FBR04sWUFBWSxDQUFDLEVBQUQsQ0FBOUI7O0FBRUEsU0FBU0EsWUFBVCxDQUFzQk8sS0FBdEIsRUFBNkI7QUFDM0IsTUFBSUMsQ0FBQyxHQUFHLElBQUliLE9BQUosQ0FBWUEsT0FBTyxDQUFDYyxHQUFwQixDQUFSO0FBQ0FELEVBQUFBLENBQUMsQ0FBQ0UsR0FBRixHQUFRLENBQVI7QUFDQUYsRUFBQUEsQ0FBQyxDQUFDRyxHQUFGLEdBQVFKLEtBQVI7QUFDQSxT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aEIsRUFBdUJNLElBQXZCLENBQTRCRCxPQUE1QixFQUFxQ0ksTUFBckM7QUFDRCxLQUZEO0FBR0QsR0FKTSxDQUFQO0FBS0QsQ0FORDs7QUFVQXJCLE9BQU8sQ0FBQzBCLFNBQVIsQ0FBa0IsT0FBbEIsSUFBNkIsVUFBVVcsVUFBVixFQUFzQjtBQUNqRCxTQUFPLEtBQUtuQixJQUFMLENBQVUsSUFBVixFQUFnQm1CLFVBQWhCLENBQVA7QUFDRCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vL1RoaXMgZmlsZSBjb250YWlucyB0aGUgRVM2IGV4dGVuc2lvbnMgdG8gdGhlIGNvcmUgUHJvbWlzZXMvQSsgQVBJXG5cbnZhciBQcm9taXNlID0gcmVxdWlyZSgnLi9jb3JlLmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gUHJvbWlzZTtcblxuLyogU3RhdGljIEZ1bmN0aW9ucyAqL1xuXG52YXIgVFJVRSA9IHZhbHVlUHJvbWlzZSh0cnVlKTtcbnZhciBGQUxTRSA9IHZhbHVlUHJvbWlzZShmYWxzZSk7XG52YXIgTlVMTCA9IHZhbHVlUHJvbWlzZShudWxsKTtcbnZhciBVTkRFRklORUQgPSB2YWx1ZVByb21pc2UodW5kZWZpbmVkKTtcbnZhciBaRVJPID0gdmFsdWVQcm9taXNlKDApO1xudmFyIEVNUFRZU1RSSU5HID0gdmFsdWVQcm9taXNlKCcnKTtcblxuZnVuY3Rpb24gdmFsdWVQcm9taXNlKHZhbHVlKSB7XG4gIHZhciBwID0gbmV3IFByb21pc2UoUHJvbWlzZS5fNjEpO1xuICBwLl82NSA9IDE7XG4gIHAuXzU1ID0gdmFsdWU7XG4gIHJldHVybiBwO1xufVxuUHJvbWlzZS5yZXNvbHZlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFByb21pc2UpIHJldHVybiB2YWx1ZTtcblxuICBpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiBOVUxMO1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIFVOREVGSU5FRDtcbiAgaWYgKHZhbHVlID09PSB0cnVlKSByZXR1cm4gVFJVRTtcbiAgaWYgKHZhbHVlID09PSBmYWxzZSkgcmV0dXJuIEZBTFNFO1xuICBpZiAodmFsdWUgPT09IDApIHJldHVybiBaRVJPO1xuICBpZiAodmFsdWUgPT09ICcnKSByZXR1cm4gRU1QVFlTVFJJTkc7XG5cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciB0aGVuID0gdmFsdWUudGhlbjtcbiAgICAgIGlmICh0eXBlb2YgdGhlbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UodGhlbi5iaW5kKHZhbHVlKSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHJlamVjdChleCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhbHVlUHJvbWlzZSh2YWx1ZSk7XG59O1xuXG5Qcm9taXNlLmFsbCA9IGZ1bmN0aW9uIChhcnIpIHtcbiAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgaWYgKGFyZ3MubGVuZ3RoID09PSAwKSByZXR1cm4gcmVzb2x2ZShbXSk7XG4gICAgdmFyIHJlbWFpbmluZyA9IGFyZ3MubGVuZ3RoO1xuICAgIGZ1bmN0aW9uIHJlcyhpLCB2YWwpIHtcbiAgICAgIGlmICh2YWwgJiYgKHR5cGVvZiB2YWwgPT09ICdvYmplY3QnIHx8IHR5cGVvZiB2YWwgPT09ICdmdW5jdGlvbicpKSB7XG4gICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQcm9taXNlICYmIHZhbC50aGVuID09PSBQcm9taXNlLnByb3RvdHlwZS50aGVuKSB7XG4gICAgICAgICAgd2hpbGUgKHZhbC5fNjUgPT09IDMpIHtcbiAgICAgICAgICAgIHZhbCA9IHZhbC5fNTU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh2YWwuXzY1ID09PSAxKSByZXR1cm4gcmVzKGksIHZhbC5fNTUpO1xuICAgICAgICAgIGlmICh2YWwuXzY1ID09PSAyKSByZWplY3QodmFsLl81NSk7XG4gICAgICAgICAgdmFsLnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgcmVzKGksIHZhbCk7XG4gICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHRoZW4gPSB2YWwudGhlbjtcbiAgICAgICAgICBpZiAodHlwZW9mIHRoZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHZhciBwID0gbmV3IFByb21pc2UodGhlbi5iaW5kKHZhbCkpO1xuICAgICAgICAgICAgcC50aGVuKGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgcmVzKGksIHZhbCk7XG4gICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYXJnc1tpXSA9IHZhbDtcbiAgICAgIGlmICgtLXJlbWFpbmluZyA9PT0gMCkge1xuICAgICAgICByZXNvbHZlKGFyZ3MpO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlcyhpLCBhcmdzW2ldKTtcbiAgICB9XG4gIH0pO1xufTtcblxuUHJvbWlzZS5yZWplY3QgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICByZWplY3QodmFsdWUpO1xuICB9KTtcbn07XG5cblByb21pc2UucmFjZSA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YWx1ZXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSl7XG4gICAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG4vKiBQcm90b3R5cGUgTWV0aG9kcyAqL1xuXG5Qcm9taXNlLnByb3RvdHlwZVsnY2F0Y2gnXSA9IGZ1bmN0aW9uIChvblJlamVjdGVkKSB7XG4gIHJldHVybiB0aGlzLnRoZW4obnVsbCwgb25SZWplY3RlZCk7XG59O1xuIl19